<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <title>Getting Started: Serving Web Content</title>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
    <link rel="stylesheet" href="/css/bootstrap.min.css"/>
    <script src="/js/jquery.min.js"></script>
    <script src="/js/bootstrap.min.js"></script>
    <script src="/js/compat.js"></script>
    <script src="/js/bundle.js"></script>
</head>
<body>
    <table class="table table-hover">
        <thead>
            <tr>
                <td>From</td>
                <td>To</td>
                <td>Headers</td>
                <td>Content</td>
            </tr>
        </thead>
        <tbody>
            <tr class="mail-row" th:each="mail : ${mails}">
                <td th:text="${mail.sender}"></td>
                <td th:each="recipient : ${mail.recipients}">
                    <span th:text="${recipient}"></span><br />
                </td>
                <td class="mail-headers" th:id="'mail-headers-' + ${mail.id}" th:text="${mail.headers}"></td>
                <td class="mail-content" th:id="'mail-content-' + ${mail.id}" th:text="${mail.content}"></td>
                <script th:inline="javascript">
                    /*<![CDATA[*/
                    $(document).ready(function() {
                        var headers = JSON.parse(/*[[${mail.headers}]]*/ "");
                        var content = /*[[${mail.content}]]*/ "";

                        var fullMail = "";
                        for(var i = 0; i < headers.length; i++) {
                            fullMail += headers[i].key + ": " + headers[i].value + '\n';
                        }
                        fullMail += ('\n' + content);

                        window.mailParser(fullMail, function(err, mail) {
                            $("#mail-content-" + /*[[${mail.id}]]*/ "").html(mail.html)
                            console.log(mail)
                        });
                    })
                    /*]]>*/
                </script>
            </tr>
        </tbody>
    </table>
</body>
</html>